---
title: "计算机网络笔记 - 2"
subtitle: ""
layout: post
author: "Geooo"
header-img: ""
header-style: text
tags:
  - 计算机网络
---

## 1. TCP 和 UDP
讲解TCP 三次握手和四次挥手之前，我们先了解TCP 和 UDP 这两个重量级传输层协议

💦 **用户数据报协议 UDP**（User Datagram Protocol）：

- **UDP在传输数据之前不需要先建立连接**，远程主机在收到 UDP 报文后，不需要给出任何确认。
- 虽然 UDP **不提供可靠交付**，但是在某些应用场景下，UDP是却是一种最有效的工作方式（一般用于即时通信），比如：QQ语音，QQ视频，直播等等

💦 **传输控制协议 TCP**（Transmission Control Protocol）：

- TCP 提供**面向连接**的服务，在传输数据之前必须先建立连接，数据传送结束后需要释放连接。
- TCP 不提供广播或多播服务。由于TCP 要提供**可靠**的、面向连接得到传输服务，这不仅使协议数据单元的首部增大很多，还要占用许多处理机资源。
(TCP的可靠传输体现在TCP在传输数据之前，会有三次握手来建立连接，而且在数据传递时，有确认、窗口、重传、流量控制、拥塞控制机制。在数据传输完后，还会通过四次挥手断开连接来节约系统资源)
- TCP **一般用于文件传输、发送和接受邮件、远程登录等场景**。

## 2. TCP报文段首部结构
TCP 报文段的具体格式可以不必都记住，但是其中的几个**控制位**与接下来要讲的三次握手和四次挥手息息相关，一定要牢记。

![](https://gitee.com/veal98/images/raw/master/img/20210107172335.png)

首部固定部分各字段意义如下：

- 1 - **源端口和目的端口**：各占2个字节，分别写入源端口和目的端口。(IP地址 + 端口号就可以确定一个进程地址)

- 2 - **序号/序列号** (Sequense Number, SN)：在一个TCP连接中传送的字节流的每一个字节都会按顺序编码。该字段表示本报文段所发送第一个字段的序号。**初始序列号 Init Sequense Number/ ISN** (该字段很重要)

    例如，一报文段的序号是 101，共有 100 字节的数据。这就表明：本报文段的数据的第一个字节的序号是 101，最后一个字节的序号是 200。显然，下一个报文段的数据序号应当从 201 开始，即下一个报文段的序号字段值应为 201。

- 3 - **确认号 ack**：期望收到对方下一个报文第一个数据字节的序号。若确认号为N，则表明：到序号N-1为止的所有数据都已正确收到。

- 4 - **数据偏移** (首部长度)：它指出TCP报文段的**数据起始处(TCP首部后的位置)** 距离 **TCP报文段的起始处** 有多远，这个字段实际是指出TCP报文段的首部长度。

- 5 - **保留**：占6位，应置为0，保留为今后使用。

⭐ 看上图，保留位的右边还有 6 个控制位（重要），这是TCP 用来说明该报文段性质的：

- **紧急位 URG** : 当URG = 1 时，表明此报文段中有紧急数据，是高优先级的数据，应尽快发送，不用在缓存中排队发送。该控制位需要配合紧急指针使用 (紧急指针指出本报文段中紧急数据的字节数)

    举个例子：我们需要取消一个已经发送很长程序的运行，因此用户从键盘发出中断指令，如果不用紧急数据，那么这个指令将存储在TCP缓存末尾，只有前面所有数据都处理完之后这个取消的指令才被交付接收方的应用进程。
    
- **确认 ACK** : 仅当 ACK = 1时确认号ack字段才有效，当 ACK = 0 时确认号无效。TCP 规定，在连接建立后所有传送的报文都必须把 ACK 置为 1。

- **推送 PSH** : 当两个应用进程进行交互式的通信时，有时在一端的应用进程希望在键入一个命令后立刻就能收到对方的响应。在这种情况下，TCP就可以使用推送(push) 操作。这时，发送方TCP把PSH置为1，并立刻创建个报文段发送出去。接收方 TCP 收到PSH = 1的报文段，就会尽快地交付给接收的应用进程。而不用等到整个缓存都填满了再向上交付。

- **复位 RST** : 当 RST = 1 时，表明 TCP连接中出现了严重的错误(由于主机崩溃或者其他原因)，必须释放连接，然后再重新建立传输连接。

- **同步 SYN** : SYN = 1表示这是一个连接请求或连接接受报文。

    当 SYN = 1 而ACK = 0时，表明这是一个连接请求报文段。对方若同意建立连接，则应在响应的报文段中使 SYN = 1 且 ACK = 1。

- **终止 FIN** : 用来释放一个连接。当 FIN = 1时，表明此报文段的发送发的数据已经全部发送完毕，并要求释放运输连接。

## 3. TCP 三次握手建立连接

    










